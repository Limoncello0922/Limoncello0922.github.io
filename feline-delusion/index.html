<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mid Century Myth</title>
    <style>
        :root {
            --primary-color: #E27D60;
            --secondary-color: #85DCB8;
            --accent-color: #E8A87C;
            --background-color: #F5F5F5;
            --text-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            background-color: var(--primary-color);
            color: white;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .content-section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .decorative-element {
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            margin: 2rem 0;
        }

        /* Biography Section Styles */
        .biography-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .biography-section h2 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .biography-content {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .sidebar {
            width: 250px;
            background-color: var(--background-color);
            padding: 1.5rem;
            border-radius: 8px;
            height: 400px; /* Fixed height to show 5 items */
            display: flex;
            flex-direction: column;
        }

        .sidebar-nav {
            list-style: none;
            overflow-y: auto;
            padding-right: 20px; /* Increased padding for scrollbar */
            margin: 0;
            flex: 1;
        }

        /* Custom scrollbar styling */
        .sidebar-nav::-webkit-scrollbar {
            width: 12px; /* Increased scrollbar width */
        }

        .sidebar-nav::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 6px; /* Increased border radius to match wider scrollbar */
            margin: 4px 0; /* Add some margin to the track */
        }

        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 6px; /* Increased border radius to match wider scrollbar */
            border: 2px solid var(--background-color); /* Add border to create space */
        }

        .sidebar-nav::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        .sidebar-nav li {
            margin-bottom: 1rem;
        }

        .sidebar-nav li:last-child {
            margin-bottom: 0;
        }

        .sidebar-nav button {
            width: 100%;
            padding: 0.8rem 1rem;
            border: none;
            background-color: white;
            color: var(--text-color);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            height: 60px; /* Fixed height for each button */
            display: flex;
            align-items: center;
            border: 1px solid var(--background-color);
        }

        .sidebar-nav button:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .sidebar-nav button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .bio-content {
            flex: 1;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .bio-content.fade-out {
            opacity: 0;
        }

        .bio-content h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .bio-content p {
            color: var(--text-color);
            line-height: 1.6;
        }

        .bio-image {
            width: 200px;
            height: 200px;
            background-color: var(--accent-color);
            border-radius: 50%;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-style: italic;
            font-size: 3rem;
        }

        /* Updated Inventory Section Styles */
        .inventory-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .inventory-container {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .inventory-sidebar {
            width: 250px;
            background-color: var(--background-color);
            padding: 1.5rem;
            border-radius: 8px;
            height: 300px; /* Fixed height to show 3 items */
            display: flex;
            flex-direction: column;
        }

        .inventory-nav {
            list-style: none;
            overflow-y: auto;
            padding-right: 8px;
            margin: 0;
            flex: 1;
        }

        /* Custom scrollbar styling */
        .inventory-nav::-webkit-scrollbar {
            width: 8px;
        }

        .inventory-nav::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 4px;
        }

        .inventory-nav::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .inventory-nav::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        .inventory-nav li {
            margin-bottom: 1rem;
        }

        .inventory-nav li:last-child {
            margin-bottom: 0;
        }

        .inventory-nav button {
            width: 100%;
            padding: 0.8rem 1rem;
            border: none;
            background-color: white;
            color: var(--text-color);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            height: 60px; /* Fixed height for each button */
        }

        .inventory-nav button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .inventory-nav button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .item-icon {
            font-size: 1.2rem;
        }

        .item-content {
            flex: 1;
            padding-left: 2rem;
            border-left: 2px solid var(--background-color);
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .item-content.fade-out {
            opacity: 0;
        }

        .item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .item-title {
            color: var(--primary-color);
            margin: 0;
        }

        .item-description {
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .item-details {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--background-color);
        }

        .item-details table {
            width: 100%;
            border-collapse: collapse;
        }

        .item-details td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--background-color);
        }

        .item-details td:first-child {
            width: 120px;
            color: var(--accent-color);
            font-weight: 500;
        }

        .item-details td:last-child {
            color: var(--text-color);
        }

        .empty-description {
            text-align: center;
            color: var(--accent-color);
            font-style: italic;
            padding: 2rem;
        }

        .investigator-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .investigator-section h2 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        .investigator-cards {
            display: flex;
            gap: 0rem;
            overflow-x: auto;
            padding-bottom: 0;
            align-items: flex-end;
        }
        .investigator-card {
            min-width: 350px;
            background: #fff;
            border: 4px solid #ccc;
            border-radius: 8px;
            padding: 1.5rem 1.5rem 0 1.5rem !important;
            margin-bottom: 1rem !important;
            box-shadow: 4px 2px 4px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            font-size: 0.72rem;
            transform: scale(0.99);
            transform-origin: top left;
        }
        .investigator-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .investigator-inline-input {
            width: 2.2em;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 0.72rem;
            padding: 2em 0.2em;
            margin: 0 1rem;
            text-align: center;
        }
        .investigator-meta {
            margin-bottom: 0.5rem;
        }
        .investigator-attr-table {
            display: none;
        }
        .investigator-attr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0;
            background: #f3f3f3;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }
        .investigator-attr-cell {
            padding: 0.7rem 0.5rem;
            text-align: center;
            font-size: 1rem;
            border: 1px solid #e0e0e0;
            background: #f3f3f3;
        }
        .investigator-attr-cell:nth-child(-n+3) {
            border-top: none;
        }
        .investigator-attr-cell:nth-child(3n+1) {
            border-left: none;
        }
        .investigator-attr-cell:nth-child(3n) {
            border-right: none;
        }
        .investigator-attr-cell:nth-child(n+7) {
            border-bottom: none;
        }
        .investigator-equip {
            margin-bottom: 1rem;
            font-size: 1rem;
            position: relative;
        }
        .investigator-equip-list {
            display: inline;
        }
        .investigator-equip-item {
            position: relative;
            cursor: pointer;
            margin-right: 0.5em;
            display: inline-block;
        }
        .investigator-equip-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            top: -2.2em;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 0.4em 0.8em;
            font-size: 0.85em;
            white-space: pre-line;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            min-width: 120px;
        }
        .investigator-equip-item:hover .investigator-equip-tooltip {
            display: block;
        }
        .investigator-abilities {
            display: flex;
            gap: 2rem;
        }
        .investigator-abilities ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
        }
        .investigator-abilities li {
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
        }
        .contact-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin: 2rem 0 0 0;
        }
        .avatar-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #d6d6d6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: #fff;
            flex-shrink: 0;
        }
        .contact-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1rem;
        }
        .contact-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .contact-detail {
            font-size: 1rem;
            color: #444;
            margin-bottom: 0.2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Mid Century Myth</h1>
            <p class="subtitle">Where Design Meets Legend</p>
        </div>
    </header>

    <main class="container">
        <section class="content-section">
            <h2>About</h2>
            <div class="decorative-element"></div>
            <p>Welcome to Mid Century Myth, where we explore the intersection of mid-century modern design and timeless mythology. This space is dedicated to showcasing the beauty of clean lines, organic shapes, and the stories that have shaped our world.</p>
        </section>

        <!-- 地图 Section -->
        <section class="content-section" id="map-section">
            <h2>地图</h2>
            <div class="decorative-element"></div>
            <div style="text-align:center;">
                <img src="./map/map.png" alt="地图" style="max-width:100%; height:auto; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.10); margin: 1rem 0;" />
            </div>
        </section>

        <section class="biography-section">
            <h2>人物档案</h2>
            <div class="decorative-element"></div>
            <div class="biography-content">
                <nav class="sidebar">
                    <ul class="sidebar-nav">
                        <!-- Items will be generated by JavaScript -->
                    </ul>
                </nav>
                <div class="bio-content">
                    <div class="bio-image">Photo Placeholder</div>
                    <h2>Person One</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                </div>
            </div>
        </section>

        <section class="inventory-section">
            <h2>调查记录</h2>
            <div class="decorative-element"></div>
            <div class="inventory-container">
                <nav class="inventory-sidebar">
                    <ul class="inventory-nav">
                        <!-- Items will be generated by JavaScript -->
                    </ul>
                </nav>
                <div class="item-content">
                    <div class="empty-description">
                        Select an item to view its details
                    </div>
                </div>
            </div>
        </section>

        <!-- Investigator Section -->
        <section class="investigator-section">
            <h2>调查员</h2>
            <div class="decorative-element"></div>
            <div class="investigator-cards" id="investigatorCards">
                <!-- Investigator cards will be generated by JavaScript -->
            </div>
        </section>
    </main>

    <!-- 联系我 Section -->
    <footer class="content-section" id="contact-section" style="margin-bottom: 0;">
        <div class="contact-row">
            <div class="avatar-circle">
                <!-- Avatar image or initials here -->
            </div>
            <div class="contact-info">
                <div class="contact-name">Your Name</div>
                <div class="contact-detail">邮箱: your@email.com</div>
                <div class="contact-detail">QQ: 123456789</div>
            </div>
        </div>
    </footer>

    <script>
        let currentBioIndex = 0;
        let autoRotateInterval;
        let userInteractionTimeout;
        let biographies = [];

        // Function to load biographies from the text file
        async function loadBiographies() {
            try {
                const response = await fetch('bio/people.txt');
                const text = await response.text();
                
                console.log('Raw text from file:', text); // Debug log
                
                // Split by newlines and filter out empty lines
                const lines = text.split('\n').filter(line => line.trim());
                console.log('Number of lines after split:', lines.length); // Debug log
                
                // Parse the text file
                biographies = lines.map((line, index) => {
                    console.log(`Processing line ${index + 1}:`, line); // Debug log
                    const parts = line.split(':');
                    if (parts.length < 2) {
                        console.warn(`Line ${index + 1} has invalid format:`, line);
                        return null;
                    }
                    const name = parts[0].trim();
                    const description = parts.slice(1).join(':').trim(); // Handle descriptions that might contain colons
                    console.log(`Parsed entry ${index + 1}:`, { name, description }); // Debug log
                    return { name, description };
                }).filter(entry => entry !== null); // Remove any null entries

                console.log('Final biographies array:', biographies); // Debug log
                console.log('Number of biographies:', biographies.length); // Debug log

                // Update the sidebar buttons
                const sidebarNav = document.querySelector('.sidebar-nav');
                sidebarNav.innerHTML = ''; // Clear existing buttons
                
                biographies.forEach((bio, index) => {
                    const li = document.createElement('li');
                    const button = document.createElement('button');
                    button.textContent = bio.name;
                    button.onclick = () => {
                        showBio(index);
                        handleUserInteraction();
                    };
                    if (index === 0) button.classList.add('active');
                    li.appendChild(button);
                    sidebarNav.appendChild(li);
                });

                // Show the first biography
                showBio(0);
            } catch (error) {
                console.error('Error loading biographies:', error);
                document.querySelector('.bio-content').innerHTML = `
                    <div class="error-message">
                        Error loading biographies. Please try again later.
                    </div>
                `;
            }
        }

        function showBio(index) {
            if (!biographies[index]) return;

            // Update active button
            const buttons = document.querySelectorAll('.sidebar-nav button');
            buttons.forEach(button => button.classList.remove('active'));
            buttons[index].classList.add('active');

            // Fade out current content
            const bioContent = document.querySelector('.bio-content');
            bioContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(() => {
                bioContent.innerHTML = `
                    <div class="bio-image">${biographies[index].name.charAt(0)}</div>
                    <h2>${biographies[index].name}</h2>
                    <p>${biographies[index].description}</p>
                `;
                bioContent.classList.remove('fade-out');
            }, 300); // Match this with the CSS transition duration

            currentBioIndex = index;
        }

        function startAutoRotate() {
            // Clear any existing interval
            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
            }

            // Start new interval
            autoRotateInterval = setInterval(() => {
                currentBioIndex = (currentBioIndex + 1) % biographies.length; // Use actual length
                showBio(currentBioIndex);
            }, 5000); // 5 seconds
        }

        function handleUserInteraction() {
            // Clear the auto-rotate interval
            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
            }

            // Clear any existing timeout
            if (userInteractionTimeout) {
                clearTimeout(userInteractionTimeout);
            }

            // Set a new timeout to resume auto-rotation after 10 seconds of inactivity
            userInteractionTimeout = setTimeout(() => {
                startAutoRotate();
            }, 10000);
        }

        // Updated Inventory functionality
        async function loadInventory() {
            try {
                const response = await fetch('inventory/items.txt');
                const text = await response.text();
                
                // Parse the text file
                const items = text.split('\n')
                    .filter(line => line.trim()) // Remove empty lines
                    .map(line => {
                        // Split by first three colons to get name, icon, and description
                        const parts = line.split(':');
                        const name = parts[0].trim();
                        const icon = parts[1].trim();
                        const description = parts[2].trim();
                        
                        // Get the details part (everything after the third colon)
                        const detailsText = parts.slice(3).join(':');
                        
                        // Parse details into an array of key-value pairs
                        const details = [];
                        if (detailsText) {
                            detailsText.split('|').forEach(detail => {
                                const [key, value] = detail.split(':').map(p => p.trim());
                                if (key && value) {
                                    details.push({ key, value });
                                }
                            });
                        }

                        return {
                            name,
                            icon,
                            description,
                            details
                        };
                    });

                initializeInventory(items);
            } catch (error) {
                console.error('Error loading inventory:', error);
                document.querySelector('.item-content').innerHTML = `
                    <div class="error-message">
                        Error loading inventory. Please try again later.
                    </div>
                `;
            }
        }

        function initializeInventory(items) {
            const inventoryNav = document.querySelector('.inventory-nav');
            const itemContent = document.querySelector('.item-content');
            
            // Clear existing items
            inventoryNav.innerHTML = '';
            
            // Create inventory items
            items.forEach((item, index) => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.innerHTML = `<span class="item-icon">${item.icon}</span> ${item.name}`;
                button.onclick = () => {
                    showItemDetails(item);
                };
                li.appendChild(button);
                inventoryNav.appendChild(li);
            });
        }

        function showItemDetails(item) {
            const itemContent = document.querySelector('.item-content');
            
            // Fade out current content
            itemContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(() => {
                itemContent.innerHTML = `
                    <div class="item-header">
                        <span class="item-icon">${item.icon}</span>
                        <h3 class="item-title">${item.name}</h3>
                    </div>
                    <p class="item-description">${item.description}</p>
                    ${item.details.length > 0 ? `
                        <div class="item-details">
                            <table>
                                <tbody>
                                    ${item.details.map(detail => `
                                        <tr>
                                            <td class="detail-label">${detail.key}</td>
                                            <td class="detail-value">${detail.value}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : ''}
                `;
                itemContent.classList.remove('fade-out');
            }, 300);
        }

        // Investigator Section Logic
        async function loadInvestigators() {
            try {
                const response = await fetch('./investigators/investigators.txt');
                const text = await response.text();
                // Split by horizontal line
                const blocks = text.split(/^-{3,}$/m).map(b => b.trim()).filter(Boolean);
                const investigators = blocks.map(block => {
                    const lines = block.split('\n').map(l => l.trim()).filter(Boolean);
                    // Parse fields
                    const name = lines[0] || '';
                    const meta = lines[1] || '';
                    const attrs = lines.slice(2, 11).map(l => l.split(' ')); // [[STR,80], ...]
                    const equipLine = lines[11] || '';
                    // Parse equips and their details
                    const equipRaw = equipLine.replace(/^Equip:/i, '').trim();
                    const equip = equipRaw.split(',').map(e => {
                        const match = e.match(/^\s*([^()]+)(?:\(([^)]*)\))?\s*$/);
                        if (match) {
                            return {
                                name: match[1].trim(),
                                details: match[2] ? match[2].split('|').map(s => s.trim()).join('\n') : ''
                            };
                        } else {
                            return { name: e.trim(), details: '' };
                        }
                    });
                    // 13 left abilities, 13 right abilities
                    const abilitiesLeft = lines.slice(12, 25);
                    const abilitiesRight = lines.slice(25, 38);
                    return { name, meta, attrs, equip, abilitiesLeft, abilitiesRight };
                });
                renderInvestigatorCards(investigators);
            } catch (error) {
                document.getElementById('investigatorCards').innerHTML = '<div class="error-message">Error loading investigators.</div>';
            }
        }
        function renderInvestigatorCards(investigators) {
            const container = document.getElementById('investigatorCards');
            container.innerHTML = investigators.map(inv => `
                <div class="investigator-card">
                    <h3>${inv.name}</h3>
                    <div class="investigator-meta">${inv.meta}</div>
                    <div class="investigator-attr-grid">
                        ${inv.attrs.map(attr => `<div class="investigator-attr-cell">${attr.join(' ')}</div>`).join('')}
                    </div>
                    <div class="investigator-equip"><strong>Equip:</strong> <span class="investigator-equip-list">
                        ${inv.equip.map(eq => `
                            <span class="investigator-equip-item">
                                ${eq.name}
                                ${eq.details ? `<span class='investigator-equip-tooltip'>${eq.details}</span>` : ''}
                            </span>
                        `).join(', ')}
                    </span></div>
                    <div class="investigator-abilities">
                        <ul>
                            ${inv.abilitiesLeft.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                        <ul>
                            ${inv.abilitiesRight.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        // Initialize the page
        window.onload = function() {
            loadBiographies();
            startAutoRotate();
            loadInventory();
            loadInvestigators();
        };
    </script>
</body>
</html>