<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áå´Â¶Ñ - Feline Delusion</title>
    <style>
        :root {
            --primary-color: #E27D60;
            --secondary-color: #85DCB8;
            --accent-color: #E8A87C;
            --background-color: #F5F5F5;
            --text-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            background-color: var(--primary-color);
            color: white;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .content-section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .decorative-element {
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            margin: 2rem 0;
        }

        /* Biography Section Styles */
        .biography-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .biography-section h2 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .biography-content {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .sidebar {
            width: 250px;
            background-color: var(--background-color);
            padding: 1.5rem;
            border-radius: 8px;
            height: 400px; /* Fixed height to show 5 items */
            display: flex;
            flex-direction: column;
        }

        .sidebar-nav {
            list-style: none;
            overflow-y: auto;
            padding-right: 20px; /* Increased padding for scrollbar */
            margin: 0;
            flex: 1;
        }

        /* Custom scrollbar styling */
        .sidebar-nav::-webkit-scrollbar {
            width: 12px; /* Increased scrollbar width */
        }

        .sidebar-nav::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 6px; /* Increased border radius to match wider scrollbar */
            margin: 4px 0; /* Add some margin to the track */
        }

        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 6px; /* Increased border radius to match wider scrollbar */
            border: 2px solid var(--background-color); /* Add border to create space */
        }

        .sidebar-nav::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        .sidebar-nav li {
            margin-bottom: 1rem;
        }

        .sidebar-nav li:last-child {
            margin-bottom: 0;
        }

        .sidebar-nav button {
            width: 100%;
            padding: 0.8rem 1rem;
            border: none;
            background-color: white;
            color: var(--text-color);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            height: auto; /* Êîπ‰∏∫Ëá™ÈÄÇÂ∫îÈ´òÂ∫¶ */
            min-height: 60px; /* ËÆæÁΩÆÊúÄÂ∞èÈ´òÂ∫¶ */
            display: flex;
            flex-direction: column; /* Êîπ‰∏∫Á∫µÂêëÊéíÂàó */
            justify-content: center; /* ÂûÇÁõ¥Â±Ö‰∏≠ */
            align-items: flex-start; /* Â∑¶ÂØπÈΩê */
            border: 1px solid var(--background-color);
            line-height: 1.3; /* Ê∑ªÂä†Ë°åÈ´ò */
        }

        .sidebar-nav button:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .sidebar-nav button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .bio-content {
            flex: 1;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .bio-content.fade-out {
            opacity: 0;
        }

        .bio-content h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .bio-content p {
            color: var(--text-color);
            line-height: 1.6;
        }

        .bio-image {
            width: 200px;
            height: 200px;
            background-color: var(--accent-color);
            border-radius: 50%;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-style: italic;
            font-size: 3rem;
        }

        /* Updated Inventory Section Styles */
        .inventory-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .inventory-container {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .inventory-sidebar {
            width: 250px;
            background-color: var(--background-color);
            padding: 1.5rem;
            border-radius: 8px;
            height: 300px; /* Fixed height to show 3 items */
            display: flex;
            flex-direction: column;
        }

        .inventory-nav {
            list-style: none;
            overflow-y: auto;
            padding-right: 8px;
            margin: 0;
            flex: 1;
        }

        /* Custom scrollbar styling */
        .inventory-nav::-webkit-scrollbar {
            width: 8px;
        }

        .inventory-nav::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 4px;
        }

        .inventory-nav::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .inventory-nav::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        .inventory-nav li {
            margin-bottom: 1rem;
        }

        .inventory-nav li:last-child {
            margin-bottom: 0;
        }

        .inventory-nav button {
            width: 100%;
            padding: 0.8rem 1rem;
            border: none;
            background-color: white;
            color: var(--text-color);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            height: 60px; /* Fixed height for each button */
        }

        .inventory-nav button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .inventory-nav button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .item-icon {
            font-size: 1.2rem;
        }

        .item-content {
            flex: 1;
            padding-left: 2rem;
            border-left: 2px solid var(--background-color);
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .item-content.fade-out {
            opacity: 0;
        }

        .item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .item-title {
            color: var(--primary-color);
            margin: 0;
        }

        .item-description {
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .item-details {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--background-color);
        }

        .item-details table {
            width: 100%;
            border-collapse: collapse;
        }

        .item-details td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--background-color);
        }

        .item-details td:first-child {
            width: 120px;
            color: var(--accent-color);
            font-weight: 500;
        }

        .item-details td:last-child {
            color: var(--text-color);
        }

        .empty-description {
            text-align: center;
            color: var(--accent-color);
            font-style: italic;
            padding: 2rem;
        }

        .investigator-section {
            margin: 2rem 0;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .investigator-section h2 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        .investigator-cards {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding: 1rem 0.5rem;
            align-items: flex-start;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .investigator-cards::-webkit-scrollbar {
            height: 8px;
        }
        .investigator-cards::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 4px;
        }
        .investigator-cards::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }
        .investigator-cards::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
        .investigator-card {
            min-width: 350px;
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%);
            border: none;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1rem;
            box-shadow: 
                0 4px 6px rgba(0,0,0,0.1),
                0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            font-size: 0.85rem;
            transform: translateY(0);
            transition: all 0.3s ease;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
        }
        .investigator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        .investigator-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 8px 12px rgba(0,0,0,0.1),
                0 3px 6px rgba(0,0,0,0.08);
        }
        .investigator-card h3 {
            font-size: 1.8rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--primary-color);
            letter-spacing: 0.5px;
            line-height: 1.2;
        }
        .investigator-meta {
            margin-bottom: 1rem;
            color: var(--accent-color);
            font-style: italic;
            font-size: 0.9rem;
        }
        .investigator-attr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 1px;
            background: var(--background-color);
            border-radius: 8px;
            margin: 1.5rem 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .investigator-attr-cell {
            padding: 1rem 0.75rem;
            text-align: center;
            font-size: 1rem;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        .investigator-attr-cell:hover {
            background: #f8f8f8;
        }
        .investigator-attr-cell span:first-child {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }
        .investigator-equip {
            margin: 1.5rem 0;
            font-size: 0.9rem;
            position: relative;
            line-height: 1.6;
        }
        .investigator-equip strong {
            color: var(--primary-color);
            font-weight: 600;
            margin-right: 0.5rem;
        }
        .investigator-equip-list {
            display: inline;
        }
        .investigator-equip-item {
            position: relative;
            cursor: pointer;
            margin-right: 0.5em;
            display: inline-block;
            color: var(--text-color);
            transition: color 0.2s ease;
        }
        .investigator-equip-item:hover {
            color: var(--primary-color);
        }
        .investigator-equip-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            bottom: calc(100% + 10px);
            transform: translateX(-50%);
            background: white;
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            white-space: pre-line;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 200px;
            max-width: 300px;
            line-height: 1.4;
        }
        .investigator-equip-tooltip::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -6px;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid white;
        }
        .investigator-equip-item:hover .investigator-equip-tooltip {
            display: block;
        }
        .investigator-abilities {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--background-color);
        }
        .investigator-abilities ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
        }
        .investigator-abilities li {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            transition: color 0.2s ease;
            display: flex;
            align-items: center;
        }
        .investigator-abilities li::before {
            content: '‚Ä¢';
            color: var(--accent-color);
            margin-right: 0.5rem;
            font-size: 1.2em;
        }
        .investigator-abilities li:hover {
            color: var(--primary-color);
        }
        .contact-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin: 2rem 0 0 0;
        }
        .avatar-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #d6d6d6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: #fff;
            flex-shrink: 0;
        }
        .contact-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1rem;
        }
        .contact-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .contact-detail {
            font-size: 1rem;
            color: #444;
            margin-bottom: 0.2rem;
        }

        /* Search occurrence highlight styles */
        @keyframes pulse-highlight {
            0% { background-color: rgba(226, 125, 96, 0.3); }
            50% { background-color: rgba(226, 125, 96, 0.1); }
            100% { background-color: rgba(226, 125, 96, 0.3); }
        }

        .search-occurrence-highlight {
            background-color: rgba(226, 125, 96, 0.3);
            animation: pulse-highlight 2s ease-in-out infinite;
            padding: 2px 0;
            border-radius: 2px;
        }

        /* Search Box Styles */
        .search-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.08),
                inset 0 0 0 1px rgba(255, 255, 255, 0.5);
            width: 300px;
            transition: all 0.3s ease;
        }

        .search-container::before {
            content: 'üîç';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            opacity: 0.6;
            pointer-events: none;
        }

        .search-box {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            background: transparent;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .search-box::placeholder {
            color: rgba(51, 51, 51, 0.6);
            transition: color 0.3s ease;
        }

        .search-box:focus::placeholder {
            color: rgba(51, 51, 51, 0.4);
        }

        .search-container:focus-within {
            box-shadow: 
                0 6px 16px rgba(226, 125, 96, 0.15),
                0 2px 4px rgba(226, 125, 96, 0.12),
                inset 0 0 0 1px rgba(226, 125, 96, 0.2);
            transform: translateY(-1px);
        }

        .search-results {
            display: none;
            max-height: 400px;
            overflow-y: auto;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            background: rgba(255, 255, 255, 0.98);
            border-radius: 0 0 12px 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .search-results.active {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background-color: rgba(226, 125, 96, 0.08);
        }

        .search-result-section {
            font-size: 0.8rem;
            color: var(--primary-color);
            margin-bottom: 4px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .search-result-section::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: var(--primary-color);
            border-radius: 50%;
            opacity: 0.7;
        }

        .search-result-text {
            font-size: 0.9rem;
            color: var(--text-color);
            line-height: 1.4;
        }

        .search-result-highlight {
            background-color: rgba(226, 125, 96, 0.2);
            padding: 1px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        .no-results {
            padding: 16px;
            text-align: center;
            color: var(--accent-color);
            font-style: italic;
            font-size: 0.9rem;
        }

        /* Update mobile styles for search */
        @media screen and (max-width: 768px) {
            .search-container {
                top: auto;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: calc(100% - 40px);
                max-width: 400px;
                border-radius: 12px;
            }

            .search-container:focus-within {
                transform: translate(-50%, -1px);
            }

            .search-results {
                max-height: 60vh;
                box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.1);
            }

            .search-results.active {
                animation: slideUp 0.2s ease-out;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                padding: 2rem 0;
            }

            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            /* Adjust biography section for mobile */
            .biography-content {
                flex-direction: column;
                gap: 1rem;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
            }

            .bio-content {
                padding: 1rem;
            }

            .bio-image {
                width: 150px;
                height: 150px;
            }

            /* Adjust inventory section for mobile */
            .inventory-container {
                flex-direction: column;
                gap: 1rem;
            }

            .inventory-sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
            }

            .item-content {
                padding-left: 0;
                border-left: none;
                border-top: 2px solid var(--background-color);
                padding-top: 1rem;
            }

            /* Adjust investigator cards for mobile */
            .investigator-cards {
                gap: 1rem;
                padding: 0.5rem;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }

            .investigator-card {
                min-width: calc(100% - 2rem);
                padding: 1.5rem;
                margin: 0 1rem;
                font-size: 0.8rem;
            }

            .investigator-card h3 {
                font-size: 1.5rem;
            }

            .investigator-attr-grid {
                margin: 1rem 0;
            }

            .investigator-attr-cell {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .investigator-abilities {
                gap: 1rem;
            }

            .investigator-abilities li {
                font-size: 0.8rem;
            }

            /* Add swipe hint for horizontal scrolling */
            .investigator-section::after {
                content: '‚Üê Â∑¶Âè≥ÊªëÂä®Êü•ÁúãÊõ¥Â§ö ‚Üí';
                display: block;
                text-align: center;
                padding: 0.5rem;
                color: var(--accent-color);
                font-size: 0.8rem;
                font-style: italic;
            }
        }

        /* Additional adjustments for very small screens */
        @media screen and (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .bio-image {
                width: 120px;
                height: 120px;
            }

            .investigator-card {
                min-width: calc(100% - 1rem);
                margin: 0 0.5rem;
                padding: 1rem;
            }

            .investigator-card h3 {
                font-size: 1.25rem;
            }

            .investigator-attr-cell {
                padding: 0.5rem 0.25rem;
                font-size: 0.8rem;
            }

            .investigator-equip {
                font-size: 0.8rem;
            }

            /* Adjust tooltip position for better mobile visibility */
            .investigator-equip-tooltip {
                left: 0;
                right: 0;
                transform: none;
                min-width: auto;
                max-width: none;
                bottom: calc(100% + 5px);
            }

            .investigator-equip-tooltip::after {
                left: 20px;
                transform: none;
            }
        }

        /* Ensure touch scrolling works smoothly */
        @media (hover: none) and (pointer: coarse) {
            .sidebar-nav,
            .inventory-nav,
            .investigator-cards {
                -webkit-overflow-scrolling: touch;
            }

            .investigator-card {
                touch-action: pan-x;
            }
        }

        /* Prevent text selection during card swipe */
        @media (pointer: coarse) {
            .investigator-card {
                user-select: none;
                -webkit-user-select: none;
            }
        }

        /* Add map styles */
        .map-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            cursor: pointer;
        }

        .map-stack {
            position: relative;
            padding-bottom: 10px;
            padding-right: 10px;
        }

        .map-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.10);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .map-image.top {
            position: relative;
            z-index: 2;
        }

        .map-image.bottom {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 0;
            opacity: 0.7;
            transform: scale(0.98);
            z-index: 1;
        }

        .map-container:hover .map-image.top {
            transform: translateY(-5px);
        }

        .map-container:hover .map-image.bottom {
            transform: scale(0.97) translateY(5px);
        }
    </style>
</head>
<body>
    <!-- Add Search Box -->
    <div class="search-container">
        <input type="text" class="search-box" placeholder="ÊêúÁ¥¢ÂÜÖÂÆπ..." />
        <div class="search-results"></div>
    </div>

    <header>
        <div class="container">
            <h1>Áå´Â¶Ñ</h1>
            <p class="subtitle">Feline Delusion</p>
        </div>
    </header>

    <main class="container">
        <section class="content-section">
            <h2>About</h2>
            <div class="decorative-element"></div>
            <div class="about-content">
                <!-- Content will be loaded from introduction.txt -->
            </div>
        </section>

        <!-- Âú∞Âõæ Section -->
        <section class="content-section" id="map-section">
            <h2>Âú∞Âõæ</h2>
            <div class="decorative-element"></div>
            <div class="map-container">
                <div class="map-stack">
                    <img src="./map/main_map.png" alt="‰∏ªÂú∞Âõæ" class="map-image top" onerror="this.src='./map/main_map.jpg'">
                    <img src="./map/current_map.png" alt="ÂΩìÂâçÂú∞Âõæ" class="map-image bottom" onerror="this.src='./map/current_map.jpg'">
                </div>
            </div>
        </section>

        <section class="biography-section">
            <h2>‰∫∫Áâ©Ê°£Ê°à</h2>
            <div class="decorative-element"></div>
            <div class="biography-content">
                <nav class="sidebar">
                    <ul class="sidebar-nav">
                        <!-- Items will be generated by JavaScript -->
                    </ul>
                </nav>
                <div class="bio-content">
                    <div class="bio-image">Photo Placeholder</div>
                    <h2>Person One</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                </div>
            </div>
        </section>

        <section class="inventory-section">
            <h2>Ë∞ÉÊü•ËÆ∞ÂΩï</h2>
            <div class="decorative-element"></div>
            <div class="inventory-container">
                <nav class="inventory-sidebar">
                    <ul class="inventory-nav">
                        <!-- Items will be generated by JavaScript -->
                    </ul>
                </nav>
                <div class="item-content">
                    <div class="empty-description">
                        Select an item to view its details
                    </div>
                </div>
            </div>
        </section>

        <!-- Investigator Section -->
        <section class="investigator-section">
            <h2>Ë∞ÉÊü•Âëò</h2>
            <div class="decorative-element"></div>
            <div class="investigator-cards" id="investigatorCards">
                <!-- Investigator cards will be generated by JavaScript -->
            </div>
        </section>
    </main>

    <!-- ËÅîÁ≥ªÊàë Section -->
    <footer class="content-section" id="contact-section" style="margin-bottom: 0;">
        <div class="contact-row">
            <div class="avatar-circle">
                <!-- Avatar image or initials here -->
            </div>
            <div class="contact-info">
                <div class="contact-name">Your Name</div>
                <div class="contact-detail">ÈÇÆÁÆ±: your@email.com</div>
                <div class="contact-detail">QQ: 123456789</div>
            </div>
        </div>
    </footer>

    <script>
        let currentBioIndex = 0;
        let biographies = [];
        let avatarConfig = {};
        let searchableContent = [];
        let items = []; // Store inventory items globally
        let investigators = []; // Store investigators globally

        // Load introduction text
        async function loadIntroduction() {
            try {
                const response = await fetch('./introduction/introduction.txt');
                const text = await response.text();
                
                // Split by ## for multiple paragraphs if needed
                const paragraphs = text.split('##').map(p => p.trim());
                
                // Update the about content
                const aboutContent = document.querySelector('.about-content');
                aboutContent.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');

                // Update searchable content
                collectSearchableContent();
            } catch (error) {
                console.error('Error loading introduction:', error);
                document.querySelector('.about-content').innerHTML = `
                    <div class="error-message">
                        Error loading introduction. Please try again later.
                    </div>
                `;
            }
        }

        // Function to collect searchable content
        function collectSearchableContent() {
            searchableContent = [];

            // About section
            const aboutContent = document.querySelector('.about-content');
            if (aboutContent) {
                searchableContent.push({
                    section: 'About',
                    text: aboutContent.textContent,
                    element: aboutContent.closest('section')
                });
            }

            // Biographies
            biographies.forEach(bio => {
                searchableContent.push({
                    section: '‰∫∫Áâ©Ê°£Ê°à',
                    text: `${bio.name} ${bio.description}`,
                    element: document.querySelector('.biography-section')
                });
            });

            // Inventory items - include both names and descriptions
            const inventoryItems = document.querySelectorAll('.inventory-nav button');
            inventoryItems.forEach(button => {
                const itemName = button.textContent.trim();
                const item = items.find(i => i.name === itemName.replace(button.querySelector('.item-icon').textContent.trim(), '').trim());
                if (item) {
                    searchableContent.push({
                        section: 'Ë∞ÉÊü•ËÆ∞ÂΩï',
                        text: `${item.name} ${item.description}`,
                        element: document.querySelector('.inventory-section')
                    });
                }
            });

            // Investigator cards
            investigators.forEach(inv => {
                const cardText = `${inv.name} ${inv.meta} ${inv.attrs.map(attr => attr.join(' ')).join(' ')} ${
                    inv.equip.map(eq => `${eq.name} ${eq.details}`).join(' ')
                } ${inv.abilitiesLeft.join(' ')} ${inv.abilitiesRight.join(' ')}`;
                
                searchableContent.push({
                    section: 'Ë∞ÉÊü•Âëò',
                    text: cardText,
                    element: document.querySelector('.investigator-section')
                });
            });
        }

        // Âä†ËΩΩÂ§¥ÂÉèÈÖçÁΩÆ
        async function loadAvatarConfig() {
            try {
                const response = await fetch('bio/avatars.json');
                avatarConfig = await response.json();
            } catch (error) {
                console.error('Error loading avatar config:', error);
            }
        }

        // Ëé∑ÂèñÂ§¥ÂÉèURL
        async function getAvatarUrl(name) {
            const baseName = name.split(/[Ôºà(]/)[0].trim(); // Ëé∑Âèñ‰∏≠ÊñáÂêçÔºåÊîØÊåÅ‰∏≠Ëã±ÊñáÊã¨Âè∑
            const baseFileName = avatarConfig[baseName];
            if (!baseFileName) return null;

            // ÁßªÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊñá‰ª∂Êâ©Â±ïÂêç
            const fileNameWithoutExt = baseFileName.split('.')[0];
            
            // ÊîØÊåÅÁöÑÂõæÁâáÊ†ºÂºè
            const extensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];
            
            // Â∞ùËØïÊâÄÊúâÂèØËÉΩÁöÑÊñá‰ª∂Ê†ºÂºè
            for (const ext of extensions) {
                const fileName = fileNameWithoutExt + ext;
                try {
                    const response = await fetch(`images/avatars/${fileName}`);
                    if (response.ok) {
                        return `images/avatars/${fileName}`;
                    }
                } catch (e) {
                    continue;
                }
            }
            return null;
        }

        // Function to load biographies from the text file
        async function loadBiographies() {
            try {
                // È¶ñÂÖàÂä†ËΩΩÂ§¥ÂÉèÈÖçÁΩÆ
                await loadAvatarConfig();

                const response = await fetch('bio/people.txt');
                const text = await response.text();
                
                // Split by newlines and filter out empty lines
                const lines = text.split('\n').filter(line => line.trim());
                
                // Parse the text file
                biographies = lines.map((line, index) => {
                    // ÂêåÊó∂ÊîØÊåÅÂÖ®ËßíÂíåÂçäËßíÂÜíÂè∑
                    const parts = line.split(/[Ôºö:]/);
                    if (parts.length < 2) {
                        console.warn(`Line ${index + 1} has invalid format:`, line);
                        return null;
                    }
                    const name = parts[0].trim();
                    const description = parts.slice(1).join(':').trim();
                    return { name, description };
                }).filter(entry => entry !== null);

                // Update the sidebar buttons
                const sidebarNav = document.querySelector('.sidebar-nav');
                sidebarNav.innerHTML = '';
                
                biographies.forEach((bio, index) => {
                    const li = document.createElement('li');
                    const button = document.createElement('button');
                    // ÂàÜÂâ≤ÂêçÂ≠ó‰∏≠ÁöÑÊã¨Âè∑ÈÉ®ÂàÜÔºåÂêåÊó∂ÊîØÊåÅ‰∏≠Ëã±ÊñáÊã¨Âè∑
                    const nameParts = bio.name.match(/(.*?)[Ôºà(]([^Ôºâ)]*)[Ôºâ)]/) || [null, bio.name, ''];
                    if (nameParts && nameParts[1]) {
                        const mainName = nameParts[1].trim();
                        const engName = nameParts[2] ? nameParts[2].trim() : '';
                        button.innerHTML = `${mainName}<br>${engName}`;
                    } else {
                        button.textContent = bio.name;
                    }
                    button.onclick = () => {
                        showBio(index);
                    };
                    if (index === 0) button.classList.add('active');
                    li.appendChild(button);
                    sidebarNav.appendChild(li);
                });

                // Show the first biography
                showBio(0);
            } catch (error) {
                console.error('Error loading biographies:', error);
                document.querySelector('.bio-content').innerHTML = `
                    <div class="error-message">
                        Error loading biographies. Please try again later.
                    </div>
                `;
            }
        }

        async function showBio(index) {
            if (!biographies[index]) return;

            // Update active button
            const buttons = document.querySelectorAll('.sidebar-nav button');
            buttons.forEach(button => button.classList.remove('active'));
            buttons[index].classList.add('active');

            // Fade out current content
            const bioContent = document.querySelector('.bio-content');
            bioContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(async () => {
                const paragraphs = biographies[index].description.split('##').map(p => p.trim());
                const avatarUrl = await getAvatarUrl(biographies[index].name);
                
                bioContent.innerHTML = `
                    <div class="bio-image">
                        ${avatarUrl ? 
                            `<img src="${avatarUrl}" alt="${biographies[index].name}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">` :
                            biographies[index].name.charAt(0)
                        }
                    </div>
                    <h2>${biographies[index].name}</h2>
                    ${paragraphs.map(p => `<p>${p}</p>`).join('')}
                `;
                bioContent.classList.remove('fade-out');
            }, 300);

            currentBioIndex = index;
        }

        // Updated Inventory functionality
        async function loadInventory() {
            try {
                const response = await fetch('inventory/items.txt');
                const text = await response.text();
                
                // Parse the text file
                items = text.split('\n')
                    .filter(line => line.trim()) // Remove empty lines
                    .map(line => {
                        // Split by first three colons to get name, icon, and description
                        const parts = line.split(':');
                        const name = parts[0].trim();
                        const icon = parts[1].trim();
                        const description = parts[2].trim();
                        
                        // Get the details part (everything after the third colon)
                        const detailsText = parts.slice(3).join(':');
                        
                        // Parse details into an array of key-value pairs
                        const details = [];
                        if (detailsText) {
                            detailsText.split('|').forEach(detail => {
                                const [key, value] = detail.split(':').map(p => p.trim());
                                if (key && value) {
                                    details.push({ key, value });
                                }
                            });
                        }

                        return {
                            name,
                            icon,
                            description,
                            details
                        };
                    });

                initializeInventory(items);
            } catch (error) {
                console.error('Error loading inventory:', error);
                document.querySelector('.item-content').innerHTML = `
                    <div class="error-message">
                        Error loading inventory. Please try again later.
                    </div>
                `;
            }
        }

        function initializeInventory(items) {
            const inventoryNav = document.querySelector('.inventory-nav');
            const itemContent = document.querySelector('.item-content');
            
            // Clear existing items
            inventoryNav.innerHTML = '';
            
            // Create inventory items
            items.forEach((item, index) => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.innerHTML = `<span class="item-icon">${item.icon}</span> ${item.name}`;
                button.onclick = () => {
                    showItemDetails(item);
                };
                li.appendChild(button);
                inventoryNav.appendChild(li);
            });

            // Update searchable content after inventory is loaded
            collectSearchableContent();
        }

        function showItemDetails(item) {
            const itemContent = document.querySelector('.item-content');
            
            // Update active button state
            const buttons = document.querySelectorAll('.inventory-nav button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if (button.textContent.includes(item.name)) {
                    button.classList.add('active');
                }
            });
            
            // Fade out current content
            itemContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(() => {
                // Â∞ÜÊèèËø∞Êåâ##ÂàÜÊÆµ
                const descriptionParagraphs = item.description.split('##').map(p => p.trim());
                
                itemContent.innerHTML = `
                    <div class="item-header">
                        <span class="item-icon">${item.icon}</span>
                        <h3 class="item-title">${item.name}</h3>
                    </div>
                    ${descriptionParagraphs.map(p => `<p class="item-description">${p}</p>`).join('')}
                    ${item.details.length > 0 ? `
                        <div class="item-details">
                            <table>
                                <tbody>
                                    ${item.details.map(detail => `
                                        <tr>
                                            <td class="detail-label">${detail.key}</td>
                                            <td class="detail-value">${detail.value}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : ''}
                `;
                itemContent.classList.remove('fade-out');
            }, 300);
        }

        // Investigator Section Logic
        async function loadInvestigators() {
            try {
                const response = await fetch('./investigators/investigators.txt');
                const text = await response.text();
                // Split by horizontal line
                const blocks = text.split(/^-{3,}$/m).map(b => b.trim()).filter(Boolean);
                investigators = blocks.map(block => {
                    const lines = block.split('\n').map(l => l.trim()).filter(Boolean);
                    // Parse fields
                    const name = lines[0] || '';
                    const meta = lines[1] || '';
                    const attrs = lines.slice(2, 11).map(l => l.split(' ')); // [[STR,80], ...]
                    const equipLine = lines[11] || '';
                    // Parse equips and their details
                    const equipRaw = equipLine.replace(/^Equip:/i, '').trim();
                    const equip = equipRaw.split(',').map(e => {
                        const match = e.match(/^\s*([^()]+)(?:\(([^)]*)\))?\s*$/);
                        if (match) {
                            return {
                                name: match[1].trim(),
                                details: match[2] ? match[2].split('|').map(s => s.trim()).join('\n') : ''
                            };
                        } else {
                            return { name: e.trim(), details: '' };
                        }
                    });
                    // 13 left abilities, 13 right abilities
                    const abilitiesLeft = lines.slice(12, 25);
                    const abilitiesRight = lines.slice(25, 38);
                    return { name, meta, attrs, equip, abilitiesLeft, abilitiesRight };
                });
                renderInvestigatorCards(investigators);
            } catch (error) {
                document.getElementById('investigatorCards').innerHTML = '<div class="error-message">Error loading investigators.</div>';
            }
        }

        function renderInvestigatorCards(investigators) {
            const container = document.getElementById('investigatorCards');
            container.innerHTML = investigators.map(inv => `
                <div class="investigator-card">
                    <h3>${inv.name}</h3>
                    <div class="investigator-meta">${inv.meta}</div>
                    <div class="investigator-attr-grid">
                        ${inv.attrs.map(attr => `<div class="investigator-attr-cell">${attr.join(' ')}</div>`).join('')}
                    </div>
                    <div class="investigator-equip"><strong>Equip:</strong> <span class="investigator-equip-list">
                        ${inv.equip.map(eq => `
                            <span class="investigator-equip-item">
                                ${eq.name}
                                ${eq.details ? `<span class='investigator-equip-tooltip'>${eq.details}</span>` : ''}
                            </span>
                        `).join(', ')}
                    </span></div>
                    <div class="investigator-abilities">
                        <ul>
                            ${inv.abilitiesLeft.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                        <ul>
                            ${inv.abilitiesRight.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        function renderInvestigatorCardsWithHighlight(investigators, query) {
            const container = document.getElementById('investigatorCards');
            container.innerHTML = investigators.map(inv => `
                <div class="investigator-card">
                    <h3>${highlightText(inv.name, query)}</h3>
                    <div class="investigator-meta">${highlightText(inv.meta, query)}</div>
                    <div class="investigator-attr-grid">
                        ${inv.attrs.map(attr => `<div class="investigator-attr-cell">${highlightText(attr.join(' '), query)}</div>`).join('')}
                    </div>
                    <div class="investigator-equip"><strong>Equip:</strong> <span class="investigator-equip-list">
                        ${inv.equip.map(eq => `
                            <span class="investigator-equip-item">
                                ${highlightText(eq.name, query)}
                                ${eq.details ? `<span class='investigator-equip-tooltip'>${highlightText(eq.details, query)}</span>` : ''}
                            </span>
                        `).join(', ')}
                    </span></div>
                    <div class="investigator-abilities">
                        <ul>
                            ${inv.abilitiesLeft.map(a => `<li>${highlightText(a, query)}</li>`).join('')}
                        </ul>
                        <ul>
                            ${inv.abilitiesRight.map(a => `<li>${highlightText(a, query)}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        // Search functionality
        function initializeSearch() {
            const searchBox = document.querySelector('.search-box');
            const searchResults = document.querySelector('.search-results');
            
            // Collect searchable content when the page loads
            collectSearchableContent();

            // Handle input changes
            searchBox.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                handleSearch(query, searchResults);
            });

            // Handle Enter key press
            searchBox.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = searchBox.value.trim();
                    handleSearch(query, searchResults);
                    
                    // If there's exactly one result, trigger it automatically
                    const results = document.querySelectorAll('.search-result-item');
                    if (results.length === 1) {
                        results[0].click();
                    }
                }
            });
        }

        function handleSearch(query, searchResults) {
            // Check minimum character requirement
            if (!isValidSearchQuery(query)) {
                searchResults.classList.remove('active');
                return;
            }

            const results = searchContent(query);
            displaySearchResults(results, query);
        }

        function isValidSearchQuery(query) {
            // No character limit for Chinese text
            if (/[\u4e00-\u9fa5]/.test(query)) {
                return query.length > 0;
            }
            // Minimum 3 characters for English text
            return query.length >= 3;
        }

        function searchContent(query) {
            const results = [];
            const queryLower = query.toLowerCase();

            searchableContent.forEach(content => {
                const textLower = content.text.toLowerCase();
                const index = textLower.indexOf(queryLower);
                
                if (index !== -1) {
                    // Get surrounding context (50 characters before and after)
                    const start = Math.max(0, index - 50);
                    const end = Math.min(content.text.length, index + query.length + 50);
                    let matchText = content.text.substring(start, end);

                    // Add ellipsis if necessary
                    if (start > 0) matchText = '...' + matchText;
                    if (end < content.text.length) matchText = matchText + '...';

                    results.push({
                        section: content.section,
                        text: matchText,
                        element: content.element,
                        matchIndex: index - start + (start > 0 ? 3 : 0) // Adjust for ellipsis
                    });
                }
            });

            return results;
        }

        function displaySearchResults(results, query) {
            const searchResults = document.querySelector('.search-results');
            
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="no-results">Êú™ÊâæÂà∞Áõ∏ÂÖ≥ÂÜÖÂÆπ</div>';
                searchResults.classList.add('active');
                return;
            }

            const resultsHtml = results.map(result => {
                const beforeMatch = result.text.substring(0, result.matchIndex);
                const match = result.text.substr(result.matchIndex, query.length);
                const afterMatch = result.text.substring(result.matchIndex + query.length);

                return `
                    <div class="search-result-item" data-section="${result.section}" data-query="${encodeURIComponent(query)}">
                        <div class="search-result-section">${result.section}</div>
                        <div class="search-result-text">
                            ${beforeMatch}<span class="search-result-highlight">${match}</span>${afterMatch}
                        </div>
                    </div>
                `;
            }).join('');

            searchResults.innerHTML = resultsHtml;
            searchResults.classList.add('active');

            // Add click handlers for results
            document.querySelectorAll('.search-result-item').forEach((item, index) => {
                item.addEventListener('click', () => {
                    const result = results[index];
                    const element = result.element;
                    const query = decodeURIComponent(item.dataset.query);
                    
                    // Scroll the outer scrollbar to the section
                    element.scrollIntoView({ behavior: 'smooth' });
                    
                    // Handle inner scrolling and content display based on section
                    if (result.section === '‰∫∫Áâ©Ê°£Ê°à') {
                        // Find the matching biography
                        const bioIndex = biographies.findIndex(bio => 
                            bio.name === result.text.split(/[Ôºö:]/)[0].trim() || 
                            result.text.includes(bio.name)
                        );
                        
                        if (bioIndex !== -1) {
                            // Find the button in the sidebar
                            const sidebarNav = document.querySelector('.sidebar-nav');
                            const button = sidebarNav.children[bioIndex].querySelector('button');
                            
                            // Scroll the inner scrollbar to the button
                            button.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            
                            // Show the biography content using existing function with highlight
                            showBioWithHighlight(bioIndex, query);
                        }
                    } else if (result.section === 'Ë∞ÉÊü•ËÆ∞ÂΩï') {
                        // Find the matching inventory item
                        const itemName = result.text.split(/[Ôºö:]/)[0].trim();
                        const matchingItem = items.find(item => 
                            item.name === itemName || 
                            result.text.includes(item.name)
                        );
                        
                        if (matchingItem) {
                            // Find the button in the sidebar
                            const inventoryNav = document.querySelector('.inventory-nav');
                            const buttons = inventoryNav.querySelectorAll('button');
                            const button = Array.from(buttons).find(btn => 
                                btn.textContent.includes(matchingItem.name)
                            );
                            
                            if (button) {
                                // Scroll the inner scrollbar to the button
                                button.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                
                                // Show the item details using existing function with highlight
                                showItemDetailsWithHighlight(matchingItem, query);
                            }
                        }
                    } else if (result.section === 'Ë∞ÉÊü•Âëò') {
                        // Find the matching investigator
                        const matchingInvestigator = investigators.find(inv => {
                            const cardText = `${inv.name} ${inv.meta} ${inv.attrs.map(attr => attr.join(' ')).join(' ')} ${
                                inv.equip.map(eq => `${eq.name} ${eq.details}`).join(' ')
                            } ${inv.abilitiesLeft.join(' ')} ${inv.abilitiesRight.join(' ')}`;
                            return cardText.toLowerCase().includes(query.toLowerCase());
                        });

                        // Re-render investigator cards with highlighted text
                        renderInvestigatorCardsWithHighlight(investigators, query);

                        // Find and scroll to the specific card
                        if (matchingInvestigator) {
                            setTimeout(() => {
                                const cards = document.querySelectorAll('.investigator-card');
                                const matchingCard = Array.from(cards).find(card => 
                                    card.querySelector('h3').textContent.includes(matchingInvestigator.name)
                                );
                                if (matchingCard) {
                                    matchingCard.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
                                }
                            }, 100); // Small delay to ensure rendering is complete
                        }
                    }
                    
                    // Hide search results
                    searchResults.classList.remove('active');
                });
            });
        }

        function highlightText(text, query) {
            if (!query) return text;
            const queryLower = query.toLowerCase();
            const textLower = text.toLowerCase();
            const parts = [];
            let lastIndex = 0;
            let currentIndex = textLower.indexOf(queryLower);

            while (currentIndex !== -1) {
                // Add text before match
                parts.push(text.substring(lastIndex, currentIndex));
                // Add highlighted match
                parts.push(`<span class="search-occurrence-highlight">${text.substring(currentIndex, currentIndex + query.length)}</span>`);
                // Update indices
                lastIndex = currentIndex + query.length;
                currentIndex = textLower.indexOf(queryLower, lastIndex);
            }
            // Add remaining text
            parts.push(text.substring(lastIndex));
            return parts.join('');
        }

        function showBioWithHighlight(index, query) {
            if (!biographies[index]) return;

            // Update active button
            const buttons = document.querySelectorAll('.sidebar-nav button');
            buttons.forEach(button => button.classList.remove('active'));
            buttons[index].classList.add('active');

            // Fade out current content
            const bioContent = document.querySelector('.bio-content');
            bioContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(async () => {
                const paragraphs = biographies[index].description.split('##').map(p => p.trim());
                const avatarUrl = await getAvatarUrl(biographies[index].name);
                
                bioContent.innerHTML = `
                    <div class="bio-image">
                        ${avatarUrl ? 
                            `<img src="${avatarUrl}" alt="${biographies[index].name}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">` :
                            biographies[index].name.charAt(0)
                        }
                    </div>
                    <h2>${highlightText(biographies[index].name, query)}</h2>
                    ${paragraphs.map(p => `<p>${highlightText(p, query)}</p>`).join('')}
                `;
                bioContent.classList.remove('fade-out');
            }, 300);

            currentBioIndex = index;
        }

        function showItemDetailsWithHighlight(item, query) {
            const itemContent = document.querySelector('.item-content');
            
            // Update active button state
            const buttons = document.querySelectorAll('.inventory-nav button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if (button.textContent.includes(item.name)) {
                    button.classList.add('active');
                }
            });
            
            // Fade out current content
            itemContent.classList.add('fade-out');

            // Wait for fade out, then update content and fade in
            setTimeout(() => {
                const descriptionParagraphs = item.description.split('##').map(p => p.trim());
                
                itemContent.innerHTML = `
                    <div class="item-header">
                        <span class="item-icon">${item.icon}</span>
                        <h3 class="item-title">${highlightText(item.name, query)}</h3>
                    </div>
                    ${descriptionParagraphs.map(p => `<p class="item-description">${highlightText(p, query)}</p>`).join('')}
                    ${item.details.length > 0 ? `
                        <div class="item-details">
                            <table>
                                <tbody>
                                    ${item.details.map(detail => `
                                        <tr>
                                            <td class="detail-label">${highlightText(detail.key, query)}</td>
                                            <td class="detail-value">${highlightText(detail.value, query)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : ''}
                `;
                itemContent.classList.remove('fade-out');
            }, 300);
        }

        // Initialize the page
        window.onload = function() {
            Promise.all([
                loadIntroduction(),
                loadBiographies(),
                loadInventory(),
                loadInvestigators()
            ]).then(() => {
                initializeSearch();
                initializeMapSwitch();
            });
        };

        // Add map switching functionality
        function initializeMapSwitch() {
            const mapContainer = document.querySelector('.map-container');
            const topMap = mapContainer.querySelector('.map-image.top');
            const bottomMap = mapContainer.querySelector('.map-image.bottom');

            mapContainer.addEventListener('click', () => {
                // Swap src attributes
                const tempSrc = topMap.src;
                const tempAlt = topMap.alt;
                
                topMap.src = bottomMap.src;
                topMap.alt = bottomMap.alt;
                
                bottomMap.src = tempSrc;
                bottomMap.alt = tempAlt;
            });
        }
    </script>
</body>
</html>